<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>iTab - 网址导航</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <!-- 背景层 -->
  <div class="bg-layer" id="bgLayer"></div>
  
  <div class="container">
    <!-- 左侧导航 -->
    <aside class="sidebar" id="sidebar">
      <button class="collapse-btn" id="collapseBtn" title="收起/展开">◀</button>
      <div class="logo">
        <span class="logo-icon" id="logoIcon">🚀</span>
        <span class="logo-text" id="logoText">iTab</span>
      </div>
      <nav class="nav-menu" id="navMenu">
        <!-- 动态生成分类菜单 -->
      </nav>
      <div class="sidebar-footer">
        <button class="add-category-btn" id="addCategoryBtn"><span class="btn-icon">➕</span><span class="btn-text">添加分类</span></button>
        <button class="settings-btn" id="settingsBtn"><span class="btn-icon">⚙️</span><span class="btn-text">设置</span></button>
      </div>
    </aside>

    <!-- 右侧内容区 -->
    <main class="main-content">
      <!-- 顶部栏：时间和操作按钮 -->
      <div class="top-bar">
        <div class="time-section">
          <div class="time-display" id="timeDisplay">00:00</div>
          <div class="date-display" id="dateDisplay">1月1日 星期一</div>
        </div>
        <div class="header-actions">
          <button class="icon-size-btn" id="iconSizeBtn" title="切换图标大小">🔲</button>
          <button class="add-site-btn" id="addSiteBtn">+ 添加网站</button>
        </div>
      </div>

      <header class="header">
        <div class="search-box">
          <input type="text" id="searchInput" placeholder="搜索网站..." autocomplete="off">
          <button class="search-btn">🔍</button>
        </div>
      </header>

      <div class="content-area" id="contentArea">
        <!-- 动态生成网站卡片 -->
      </div>
    </main>
  </div>

  <!-- 设置弹窗 -->
  <div class="modal" id="settingsModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>设置</h3>
        <button class="modal-close" onclick="closeSettingsModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>网站Logo图标</label>
          <input type="text" id="logoIconInput" placeholder="emoji 或 图片URL">
          <small class="form-hint">支持 emoji 或网络图片地址</small>
        </div>
        <div class="form-group">
          <label>网站标题</label>
          <input type="text" id="logoTextInput" placeholder="网站标题">
        </div>
        <div class="settings-divider"></div>
        <div class="form-group">
          <label>背景图片</label>
          <div class="input-with-btn">
            <input type="text" id="backgroundUrl" placeholder="输入图片URL或留空使用默认背景">
            <button class="btn btn-secondary btn-small" id="previewBgBtn">预览</button>
          </div>
          <small class="form-hint">支持 jpg/png/webp 格式的图片链接</small>
        </div>
        <div class="form-group">
          <label>背景颜色</label>
          <div class="color-picker-group">
            <input type="color" id="bgColorPicker" value="#667eea" class="color-picker-input">
            <div class="color-presets">
              <button type="button" class="color-preset-btn bg-color-preset" data-color="#667eea" title="紫色" style="background: linear-gradient(135deg, #667eea, #764ba2);"></button>
              <button type="button" class="color-preset-btn bg-color-preset" data-color="#1a1a2e" title="深蓝" style="background: linear-gradient(135deg, #1a1a2e, #16213e);"></button>
              <button type="button" class="color-preset-btn bg-color-preset" data-color="#0f3460" title="海蓝" style="background: linear-gradient(135deg, #0f3460, #16537e);"></button>
              <button type="button" class="color-preset-btn bg-color-preset" data-color="#2d3436" title="深灰" style="background: linear-gradient(135deg, #2d3436, #636e72);"></button>
              <button type="button" class="color-preset-btn bg-color-preset" data-color="#ff6b6b" title="珊瑚" style="background: linear-gradient(135deg, #ff6b6b, #ee5a5a);"></button>
              <button type="button" class="color-preset-btn bg-color-preset" data-color="#00b894" title="绿色" style="background: linear-gradient(135deg, #00b894, #00a085);"></button>
            </div>
          </div>
          <small class="form-hint">选择背景颜色（无背景图片时生效）</small>
        </div>
        <div class="form-group">
          <label>图标大小</label>
          <div class="radio-group">
            <label class="radio-item">
              <input type="radio" name="iconSize" value="normal" checked>
              <span>正常</span>
            </label>
            <label class="radio-item">
              <input type="radio" name="iconSize" value="small">
              <span>紧凑</span>
            </label>
          </div>
          <small class="form-hint">紧凑模式：只显示图标和名称，背景透明</small>
        </div>
        <div class="form-group">
          <label>文字颜色</label>
          <div class="color-picker-group">
            <input type="color" id="textColorPicker" value="#ffffff" class="color-picker-input">
            <div class="color-presets">
              <button type="button" class="color-preset-btn" data-color="#ffffff" title="白色" style="background: #ffffff;"></button>
              <button type="button" class="color-preset-btn" data-color="#000000" title="黑色" style="background: #000000;"></button>
              <button type="button" class="color-preset-btn" data-color="#f5f5f5" title="浅灰" style="background: #f5f5f5;"></button>
              <button type="button" class="color-preset-btn" data-color="#ffd700" title="金色" style="background: #ffd700;"></button>
              <button type="button" class="color-preset-btn" data-color="#00ffff" title="青色" style="background: #00ffff;"></button>
              <button type="button" class="color-preset-btn" data-color="#ff6b6b" title="红色" style="background: #ff6b6b;"></button>
            </div>
          </div>
          <small class="form-hint">选择界面文字的颜色</small>
        </div>
        <div class="settings-divider"></div>
        <div class="form-group">
          <label>配置管理</label>
          <div class="btn-group">
            <button class="btn btn-secondary" id="exportBtn">📤 导出配置</button>
            <button class="btn btn-secondary" id="importBtn">📥 导入配置</button>
            <input type="file" id="importFile" accept=".json" style="display:none">
          </div>
        </div>
        <div class="form-group">
          <label>WebDAV 云备份</label>
          <div class="btn-group">
            <button class="btn btn-secondary" id="webdavSettingsBtn">☁️ 配置云备份</button>
          </div>
          <small class="form-hint">支持坚果云、Nextcloud 等 WebDAV 服务</small>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeSettingsModal()">关闭</button>
        <button class="btn btn-primary" id="saveSettingsBtn">保存设置</button>
      </div>
    </div>
  </div>

  <!-- 分类编辑弹窗 -->
  <div class="modal" id="categoryModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="categoryModalTitle">添加分类</h3>
        <button class="modal-close" onclick="closeCategoryModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>分类名称</label>
          <input type="text" id="categoryName" placeholder="输入分类名称">
        </div>
        <div class="form-group">
          <label>图标 (emoji 或 图片URL)</label>
          <input type="text" id="categoryIcon" placeholder="例如: 🔍 或 https://...">
          <small class="form-hint">支持 emoji 或网络图片地址</small>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeCategoryModal()">取消</button>
        <button class="btn btn-primary" id="saveCategoryBtn">保存</button>
      </div>
    </div>
  </div>

  <!-- 网站编辑弹窗 -->
  <div class="modal" id="siteModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="siteModalTitle">添加网站</h3>
        <button class="modal-close" onclick="closeSiteModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>网站名称</label>
          <input type="text" id="siteName" placeholder="输入网站名称">
        </div>
        <div class="form-group">
          <label>网站地址</label>
          <input type="url" id="siteUrl" placeholder="https://example.com">
        </div>
        <div class="form-group">
          <label>图标 (emoji 或 URL)</label>
          <input type="text" id="siteIcon" placeholder="🌐 或 https://...">
        </div>
        <div class="form-group">
          <label>网站描述</label>
          <textarea id="siteDesc" placeholder="简短描述" rows="2"></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeSiteModal()">取消</button>
        <button class="btn btn-primary" id="saveSiteBtn">保存</button>
      </div>
    </div>
  </div>

  <!-- 删除确认弹窗 -->
  <div class="modal" id="deleteModal">
    <div class="modal-content modal-small">
      <div class="modal-header">
        <h3>确认删除</h3>
        <button class="modal-close" onclick="closeDeleteModal()">&times;</button>
      </div>
      <div class="modal-body">
        <p id="deleteMessage">确定要删除吗？</p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeDeleteModal()">取消</button>
        <button class="btn btn-danger" id="confirmDeleteBtn">删除</button>
      </div>
    </div>
  </div>

  <!-- 右键菜单 -->
  <div class="context-menu" id="contextMenu">
    <div class="context-menu-item" id="menuEditSite">
      <span>✏️</span>
      <span>编辑网站</span>
    </div>
    <div class="context-menu-item" id="menuMoveCategory">
      <span>📁</span>
      <span>移动到分类</span>
    </div>
    <div class="context-menu-divider"></div>
    <div class="context-menu-item danger" id="menuDeleteSite">
      <span>🗑️</span>
      <span>删除网站</span>
    </div>
  </div>

  <!-- 移动分类选择弹窗 -->
  <div class="modal" id="moveCategoryModal">
    <div class="modal-content modal-small">
      <div class="modal-header">
        <h3>移动到分类</h3>
        <button class="modal-close" onclick="closeMoveCategoryModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>选择目标分类</label>
          <select id="targetCategorySelect" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:8px;font-size:14px;">
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeMoveCategoryModal()">取消</button>
        <button class="btn btn-primary" id="confirmMoveBtn">移动</button>
      </div>
    </div>
  </div>

  <!-- WebDAV备份设置弹窗 -->
  <div class="modal" id="webdavModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>WebDAV 备份设置</h3>
        <button class="modal-close" onclick="closeWebdavModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>WebDAV 服务器地址</label>
          <input type="url" id="webdavUrl" placeholder="https://dav.example.com/">
          <small class="form-hint">例如: https://dav.jianguoyun.com/dav/</small>
        </div>
        <div class="form-group">
          <label>用户名</label>
          <input type="text" id="webdavUsername" placeholder="WebDAV 用户名">
        </div>
        <div class="form-group">
          <label>密码/应用密码</label>
          <input type="password" id="webdavPassword" placeholder="WebDAV 密码">
          <small class="form-hint">坚果云等平台需要使用应用密码</small>
        </div>
        <div class="form-group">
          <label>备份目录</label>
          <input type="text" id="webdavPath" placeholder="/itab-backup/">
          <small class="form-hint">备份文件保存的目录路径</small>
        </div>
        <div class="form-group">
          <label>自动备份间隔</label>
          <select id="backupInterval" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:8px;font-size:14px;">
            <option value="0">关闭自动备份</option>
            <option value="5">每 5 分钟</option>
            <option value="15">每 15 分钟</option>
            <option value="30">每 30 分钟</option>
            <option value="60">每 1 小时</option>
            <option value="360">每 6 小时</option>
            <option value="1440">每 24 小时</option>
          </select>
        </div>
        <div class="settings-divider"></div>
        <div class="form-group">
          <label>备份状态</label>
          <div id="backupStatus" style="font-size:14px;color:#666;">
            未配置
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="testWebdavConnection()">测试连接</button>
        <button class="btn btn-secondary" onclick="manualBackup()">立即备份</button>
        <button class="btn btn-primary" id="saveWebdavBtn">保存设置</button>
      </div>
    </div>
  </div>

  <script src="js/app.js"></script>
</body>
</html>